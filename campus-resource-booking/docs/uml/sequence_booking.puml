
@startuml
autonumber
User -> ApiController: POST /api/bookings\n{resourceId,start,end,deposit}
ApiController -> BookingService: create(userId, req)
BookingService -> ResourceRepo: findById(resourceId)
BookingService -> BookingRepo: findByResourceIdAndEndTimeGreaterThanAndStartTimeLessThan(...)
alt 存在冲突
  BookingService -> ApiController: throw BizException("已被占用")
else 无冲突
  BookingService -> BookingRepo: save(Booking.NEW)
  BookingService --> ApiController: BookingResponse
end
ApiController --> User: 200 OK + BookingResponse
@enduml
